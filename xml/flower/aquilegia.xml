<?xml version="1.0" encoding="UTF-8"?>
<beast>
    <taxa>
        <taxon id="BA">
            <attr name="latent">9 3.1540172525197 7.13 18.32 0.0711 62.44 0.4876 0.4263 59.5848 0.4688 -0.737 -0.632
                0.577
            </attr>
        </taxon>
        <taxon id="JO">
            <attr name="latent">135 2.4423470353692 10.5 18.5 0.188 -58.3385 0.3827 0.188 39.6534 0.3827 0.193 -0.305
                -0.432
            </attr>
        </taxon>
        <taxon id="CA.VA.1">
            <attr name="latent">4 3.03350963788802 6.23 14.56 0.4878 11.7949 0.2326 0.2338 69.8673 0.4471 0.176 -0.201
                0.391
            </attr>
        </taxon>
        <taxon id="CHAP.NM.3">
            <attr name="latent">140 3.55248682920838 8.5 12.09 0.281 68.5242 0.4474 0.3246 64.533 0.4951 -0.42 0.019
                -0.709
            </attr>
        </taxon>
        <taxon id="CH.CHI.2">
            <attr name="latent">123 3.8155121050473 13.12 23.05 0.3095 60.8943 0.3249 0.3436 60.4306 0.4195 -0.802 0.688
                -0.092
            </attr>
        </taxon>
        <taxon id="COOC.CO.2">
            <attr name="latent">132 3.83751495325308 14.28 32.53 0.0928 74.1717 0.6178 0.1083 74.5432 0.6839 -0.4 0.938
                -0.738
            </attr>
        </taxon>
        <taxon id="CH.NM.3">
            <attr name="latent">123 3.8155121050473 13.12 23.05 0.3095 60.8943 0.3249 0.3436 60.4306 0.4195 -0.021 0.404
                -0.885
            </attr>
        </taxon>
        <taxon id="COAL.WY.1">
            <attr name="latent">122 3.79638766182922 13.53 35.58 0.0932 74.0168 0.6199 0.1047 74.1643 0.7076 -0.538
                0.216 -0.208
            </attr>
        </taxon>
        <taxon id="COCO.WY.3">
            <attr name="latent">124 3.73313554536847 18.7 34.92 0.0773 30.0447 0.3348 0.1216 74.8865 0.7017 -0.781 0.034
                -0.795
            </attr>
        </taxon>
        <taxon id="COOC.UT.4">
            <attr name="latent">132 3.83751495325308 14.28 32.53 0.0928 74.1717 0.6178 0.1083 74.5432 0.6839 -0.498
                0.314 -0.577
            </attr>
        </taxon>
        <taxon id="COPI.AZ.1">
            <attr name="latent">156 4.32558854957018 11.5 27.7 0.083 73.124 0.5849 0.1351 74.178 0.5354 -0.726 0.011
                -0.494
            </attr>
        </taxon>
        <taxon id="DE.AZ.1">
            <attr name="latent">12 2.96527306606928 5.51 13.92 0.4833 30.8233 0.2494 0.4301 52.1652 0.2794 0.079 -0.19
                0.943
            </attr>
        </taxon>
        <taxon id="EL.NM.4">
            <attr name="latent">11 3.15700042115011 7.08 13.13 0.5681 13.7677 0.1992 0.2786 60.6111 0.335 0.713 -0.756
                0.396
            </attr>
        </taxon>
        <taxon id="EX.CA.2">
            <attr name="latent">8 3.00370044320317 2.17 17.33 0.5148 14.0147 0.2279 0.4017 49.36 0.2382 0.261 -0.369
                0.958
            </attr>
        </taxon>
        <taxon id="FL.UT.5">
            <attr name="latent">9 2.70404217970467 7.4 16.78 0.2305 61.1168 0.4665 0.2992 61.3804 0.4876 -0.404 -0.807
                0.967
            </attr>
        </taxon>
        <taxon id="FO.CA.BAL.3">
            <attr name="latent">6 2.97092715463502 2.71 16.6 0.53 16.3419 0.2555 0.3836 54.2866 0.2846 0.686 -0.758
                0.456
            </attr>
        </taxon>
        <taxon id="FO.CA.BTR.1">
            <attr name="latent">6 2.97092715463502 2.71 16.6 0.53 16.3419 0.2555 0.3836 54.2866 0.2846 0.164 -0.041
                0.474
            </attr>
        </taxon>
        <taxon id="HI.TX.4">
            <attr name="latent">86 3.95546556327098 18.6 26.8 0.3043 64.1358 0.4551 0.3392 60.9225 0.5181 -0.185 0.713
                -0.044
            </attr>
        </taxon>
        <taxon id="BR.ALB.5">
            <attr name="latent">40 2.01490302054226 2.87 11.6 0.2502 -35.6264 0.0779 0.1321 39.6534 0.7528 0.126 -0.521
                -0.355
            </attr>
        </taxon>
        <taxon id="LA.WY.2">
            <attr name="latent">38 2.17133680638409 9.97 13.48 0.0169 -43.3776 0.6178 0.0169 39.6534 0.6178 -0.131
                -0.239 -0.724
            </attr>
        </taxon>
        <taxon id="LO.AZ.2">
            <attr name="latent">126 4.81971689007678 16.45 25.61 0.2566 64.7051 0.5301 0.2975 59.3753 0.6462 -0.222 0.26
                -0.308
            </attr>
        </taxon>
        <taxon id="LO.TX.5">
            <attr name="latent">126 4.81971689007678 16.45 25.61 0.2566 64.7051 0.5301 0.2975 59.3753 0.6462 -0.699 0.48
                -0.016
            </attr>
        </taxon>
        <taxon id="MI.CO.1">
            <attr name="latent">30 3.14328983791161 7.85 15.49 0.1197 44.616 0.3616 0.1674 75.1792 0.4829 -0.429 -0.779
                0.339
            </attr>
        </taxon>
        <taxon id="PU.CA.PP.3">
            <attr name="latent">125 3.69411572090918 11.08 20.2 0.113 64.0229 0.4394 0.1301 73.4112 0.5469 -0.71 0.233
                -0.303
            </attr>
        </taxon>
        <taxon id="PU.NV.3">
            <attr name="latent">130 3.47692309219029 9.15 21.67 0.1457 50.5302 0.507 0.16 63.8916 0.5744 -0.588 0.698
                -0.853
            </attr>
        </taxon>
        <taxon id="SA.CO.1">
            <attr name="latent">66 2.01089499914473 6.8 13.09 0.2006 -46.4477 0.2148 0.1331 39.6534 0.4184 0.026 -0.713
                -0.134
            </attr>
        </taxon>
        <taxon id="SC.NV.4">
            <attr name="latent">128 3.47846701715346 7.88 18.39 0.141 41.7868 0.2535 0.1151 51.0666 0.4719 0.972 0.093
                -0.135
            </attr>
        </taxon>
        <taxon id="SH.NV.4">
            <attr name="latent">2 2.96320908184843 3.47 16.54 0.4866 20.0524 0.2909 0.4124 52.6453 0.2408 0.038 -0.913
                0.48
            </attr>
        </taxon>
        <taxon id="SK.SON.2">
            <attr name="latent">-1 3.69087745677661 9.32 24.17 0.4457 19.9677 0.3079 0.2701 84.5853 0.3299 0.109 -0.762
                0.112
            </attr>
        </taxon>
        <taxon id="TR.UT.3">
            <attr name="latent">5 3.15657479867082 6.39 16.91 0.4089 31.0197 0.352 0.3237 58.9163 0.4642 0.108 -0.517
                0.37
            </attr>
        </taxon>
    </taxa>
    <alignment id="alignment" dataType="binary">

        <sequence>??????????0?1
            <taxon idref="BA"/>
        </sequence>
        <sequence>??????????100
            <taxon idref="JO"/>
        </sequence>
        <sequence>??????????1?1
            <taxon idref="CA.VA.1"/>
        </sequence>
        <sequence>??????????01?
            <taxon idref="CHAP.NM.3"/>
        </sequence>
        <sequence>??????????01?
            <taxon idref="CH.CHI.2"/>
        </sequence>
        <sequence>??????????01?
            <taxon idref="COOC.CO.2"/>
        </sequence>
        <sequence>??????????01?
            <taxon idref="CH.NM.3"/>
        </sequence>
        <sequence>??????????01?
            <taxon idref="COAL.WY.1"/>
        </sequence>
        <sequence>??????????01?
            <taxon idref="COCO.WY.3"/>
        </sequence>
        <sequence>??????????01?
            <taxon idref="COOC.UT.4"/>
        </sequence>
        <sequence>??????????01?
            <taxon idref="COPI.AZ.1"/>
        </sequence>
        <sequence>??????????1?1
            <taxon idref="DE.AZ.1"/>
        </sequence>
        <sequence>??????????1?1
            <taxon idref="EL.NM.4"/>
        </sequence>
        <sequence>??????????1?1
            <taxon idref="EX.CA.2"/>
        </sequence>
        <sequence>??????????0?1
            <taxon idref="FL.UT.5"/>
        </sequence>
        <sequence>??????????1?1
            <taxon idref="FO.CA.BAL.3"/>
        </sequence>
        <sequence>??????????1?1
            <taxon idref="FO.CA.BTR.1"/>
        </sequence>
        <sequence>??????????01?
            <taxon idref="HI.TX.4"/>
        </sequence>
        <sequence>??????????100
            <taxon idref="BR.ALB.5"/>
        </sequence>
        <sequence>??????????000
            <taxon idref="LA.WY.2"/>
        </sequence>
        <sequence>??????????01?
            <taxon idref="LO.AZ.2"/>
        </sequence>
        <sequence>??????????01?
            <taxon idref="LO.TX.5"/>
        </sequence>
        <sequence>??????????0?1
            <taxon idref="MI.CO.1"/>
        </sequence>
        <sequence>??????????01?
            <taxon idref="PU.CA.PP.3"/>
        </sequence>
        <sequence>??????????01?
            <taxon idref="PU.NV.3"/>
        </sequence>
        <sequence>??????????100
            <taxon idref="SA.CO.1"/>
        </sequence>
        <sequence>??????????11?
            <taxon idref="SC.NV.4"/>
        </sequence>
        <sequence>??????????1?1
            <taxon idref="SH.NV.4"/>
        </sequence>
        <sequence>??????????1?1
            <taxon idref="SK.SON.2"/>
        </sequence>
        <sequence>??????????1?1
            <taxon idref="TR.UT.3"/>
        </sequence>
    </alignment>
    <patterns id="patterns" from="1" unique="false" strip="false">
        <alignment idref="alignment"/>
    </patterns>
    <newick id="startingTree" usingHeights="true" usingDates="false">
        ((JO:2.644495,SA.CO.1:2.644495):0.409622,(LA.WY.2:2.717767,((CA.VA.1:2.004665,BR.ALB.5:2.004665):0.699968,((LO.TX.5:2.047423,SK.SON.2:2.047423):0.199833,((LO.AZ.2:1.817114,(CHAP.NM.3:1.698069,((CH.CHI.2:1.344339,HI.TX.4:1.344339):0.166127,(CH.NM.3:1.098793,COPI.AZ.1:1.098793):0.411672):0.187604):0.119045):0.205129,(DE.AZ.1:1.927596,((SC.NV.4:1.599147,(BA:1.416495,MI.CO.1:1.416495):0.182652):0.168978,((EL.NM.4:1.45465,(PU.NV.3:1.303123,((COOC.CO.2:0.929981,COCO.WY.3:0.929981):0.135544,(COAL.WY.1:0.883121,COOC.UT.4:0.883121):0.182404):0.237598):0.151527):0.184192,(PU.CA.PP.3:1.488794,(FL.UT.5:1.373175,((EX.CA.2:1.0,FO.CA.BAL.3:1.0):0.239958,(FO.CA.BTR.1:1.115649,(SH.NV.4:0.885012,TR.UT.3:0.885012):0.230637):0.124309):0.133217):0.115619):0.150048):0.129284):0.159471):0.094647):0.225013):0.457377):0.013134):0.336349);;
    </newick>
    <!-- Generate a tree model                                                   -->
    <treeModel id="treeModel" fixHeights="true">
        <tree idref="startingTree"/>
        <rootHeight>
            <parameter id="treeModel.rootHeight"/>
        </rootHeight>
        <nodeHeights internalNodes="true">
            <parameter id="treeModel.internalNodeHeights"/>
        </nodeHeights>
        <nodeHeights internalNodes="true" rootNode="true">
            <parameter id="treeModel.allInternalNodeHeights"/>
        </nodeHeights>
        <nodeTraits rootNode="false" internalNodes="false" leafNodes="true" asMatrix="true" traitDimension="13"
                    name="latent">
            <parameter id="leafTraits"/>
        </nodeTraits>
    </treeModel>
    <!--diffusion model-->
    <multivariateDiffusionModel id="diffusionModel">
        <precisionMatrix>
            <cachedMatrixInverse id="precisionMatrix">
                <compoundSymmetricMatrix id="varianceMatrix" asCorrelation="true" isCholesky="true">
                    <diagonal>
                        <parameter id="variance.diagonal" value="1 1 1 1 1 1 1 1 1 1 1 1 1"
                                   lower="0 0 0 0 0 0 0 0 0 0 0 0 0"/>
                    </diagonal>
                    <offDiagonal>
                        <parameter id="variance.correlation"
                                   value="0.1 0.1 0.1 0.1 0.1 0.1 0.1 0.1 0.1 0.1 0.1 0.1 0.1 0.1 0.1 0.1 0.1 0.1 0.1 0.1 0.1 0.1 0.1 0.1 0.1 0.1 0.1 0.1 0.1 0.1 0.1 0.1 0.1 0.1 0.1 0.1 0.1 0.1 0.1 0.1 0.1 0.1 0.1 0.1 0.1 0.1 0.1 0.1 0.1 0.1 0.1 0.1 0.1 0.1 0.1 0.1 0.1 0.1 0.1 0.1 0.1 0.1 0.1 0.1 0.1 0.1 0.1 0.1 0.1 0.1 0.1 0.1 0.1 0.1 0.1 0.1 0.1 0.1"/>
                    </offDiagonal>
                </compoundSymmetricMatrix>
            </cachedMatrixInverse>
        </precisionMatrix>
    </multivariateDiffusionModel>
    <traitDataLikelihood id="scalarLikelihood" traitName="latent" scaleByTime="true" forceFullPrecision="false">
        <multivariateDiffusionModel idref="diffusionModel"/>
        <treeModel idref="treeModel"/>
        <traitParameter>
            <parameter idref="leafTraits"/>
        </traitParameter>
        <conjugateRootPrior>
            <meanParameter>
                <parameter value="0 0 0 0 0 0 0 0 0 0 0 0 0"/>
            </meanParameter>
            <priorSampleSize>
                <parameter id="priorSampleSize" value="0.01"/>
            </priorSampleSize>
        </conjugateRootPrior>
        <missingIndicator latentFrom="11" latentTo="13">
            <parameter id="mask"/>
        </missingIndicator>
    </traitDataLikelihood>
    <traitDataLikelihood id="elementaryLikelihood" scaleByTime="true" forceFullPrecision="false">
        <multivariateDiffusionModel>
            <precisionMatrix>
                <matrixParameter>
                    <parameter value="1"/>
                </matrixParameter>
            </precisionMatrix>
        </multivariateDiffusionModel>
        <treeModel idref="treeModel"/>
        <!--     <transformedTreeModel idref="transformedTree"/> -->
        <elementaryVectorDataModel id="elementaryModel" tips="30" dim="1" precisionType="scalar">
            <tipIndicator>
                <parameter value="0"/>
            </tipIndicator>
        </elementaryVectorDataModel>
        <conjugateRootPrior>
            <meanParameter>
                <parameter value="0.0"/>
            </meanParameter>
            <priorSampleSize>
                <parameter idref="priorSampleSize"/>
            </priorSampleSize>
        </conjugateRootPrior>
    </traitDataLikelihood>
    <compoundParameter id="threshold">
        <parameter value="1"/>
    </compoundParameter>
    <orderedLatentLiabilityLikelihood id="liabilityLikelihood" NData="1" NTraits="13">
        <patterns idref="patterns"/>
        <treeModel idref="treeModel"/>
        <traitDataLikelihood idref="scalarLikelihood"/>
        <tipTrait>
            <parameter idref="leafTraits"/>
        </tipTrait>
        <threshold>
            <parameter idref="threshold"/>
        </threshold>
        <numClasses>
            <parameter value="1 1 1 1 1 1 1 1 1 1 2 2 2"/>
        </numClasses>
    </orderedLatentLiabilityLikelihood>
    <precisionGradient id="precisionCorrelationGradient" parameter="precisionCorrelation">
        <wishartStatistics traitName="latent">
            <traitDataLikelihood idref="scalarLikelihood"/>
        </wishartStatistics>
        <traitDataLikelihood idref="scalarLikelihood"/>
        <cachedMatrixInverse idref="precisionMatrix"/>
    </precisionGradient>
    <precisionGradient id="precisionDiagonalGradient" parameter="precisionDiagonal">
        <wishartStatistics traitName="latent">
            <traitDataLikelihood idref="scalarLikelihood"/>
        </wishartStatistics>
        <traitDataLikelihood idref="scalarLikelihood"/>
        <cachedMatrixInverse idref="precisionMatrix"/>
    </precisionGradient>
    <LKJCorrelationPrior id="prior.cholesky" shapeParameter="1.0" dimension="13" cholesky="true">
        <data>
            <parameter idref="variance.correlation"/>
        </data>
    </LKJCorrelationPrior>
    <logNormalDistributionModel id="log.normal" meanInRealSpace="false">
        <mean>0.0</mean>
        <stdev>1.0</stdev>
    </logNormalDistributionModel>
    <distributionLikelihood id="prior.diagonal">
        <distribution>
            <logNormalDistributionModel idref="log.normal"/>
        </distribution>
        <data>
            <parameter idref="variance.diagonal"/>
        </data>
    </distributionLikelihood>
    <jointGradient id="jointGradientForDiagonal">
        <gradient idref="precisionDiagonalGradient"/>
        <gradient>
            <distributionLikelihood idref="prior.diagonal"/>
            <parameter idref="variance.diagonal"/>
        </gradient>
    </jointGradient>
    <jointGradient id="jointGradientForCorrelation">
        <gradient idref="precisionCorrelationGradient"/>
        <gradient>
            <LKJCorrelationPrior idref="prior.cholesky"/>
        </gradient>
    </jointGradient>
    <compoundParameter id="correlationAndDiag">
        <parameter idref="variance.correlation"/>
        <parameter idref="variance.diagonal"/>
    </compoundParameter>
    <compoundParameter id="all">
        <parameter idref="leafTraits"/>
        <parameter idref="variance.correlation"/>
        <parameter idref="variance.diagonal"/>
    </compoundParameter>
    <parameter id="mask.hmc"
               value="1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 0 0 0"/>
    <operators id="operators">
        <NoUTurnOperator id="NUTS" weight="20" adaptiveStepsize="true" adaptiveDelay="10">
            <splitHamiltonianMonteCarloOperator weight="1" nSteps="1" nInnerSteps="1" stepSize="0.001"
                                                relativeScale="10" updateRelativeScaleFrequency="1"
                                                updateRelativeScaleDelay="1" getRelativeScaleDelay="12000"
                                                getRelativeScaleFrequency="2000">
                <compoundParameter idref="all"/>
                <zigZagOperator weight="1" reversibleFlag="true" useNativeFindBounce="false"
                                useNativeUpdateDynamics="false">
                    <traitGradientOnTree id="gradient">
                        <traitDataLikelihood idref="scalarLikelihood"/>
                    </traitGradientOnTree>
                    <precisionTraitProductOnTree id="product" traitName="latent" roughTravelTimeGuess="0.5">
                        <traitDataLikelihood idref="scalarLikelihood"/>
                    </precisionTraitProductOnTree>
                    <precisionColumnOnTree id="precisionColumn">
                        <kroneckerProduct>
                            <precisionTraitProductOnTree>
                                <traitDataLikelihood idref="elementaryLikelihood"/>
                            </precisionTraitProductOnTree>
                            <multivariateDiffusionModel idref="diffusionModel"/>
                        </kroneckerProduct>
                    </precisionColumnOnTree>
                    <mask>
                        <parameter idref="mask"/>
                    </mask>
                    <categoryClasses>
                        <parameter value="0 0 0 0 0 0 0 0 0 0 0 3 3"/>
                    </categoryClasses>
                </zigZagOperator>
                <hamiltonianMonteCarloOperator id="hmc" weight="1" nSteps="10" stepSize="0.01" mode="vanilla"
                                               drawVariance="1.0" gradientCheckCount="0" gradientCheckTolerance="0.01">
                    <compoundParameter idref="correlationAndDiag"/>
                    <compoundGradient>
                        <jointGradient idref="jointGradientForCorrelation"/>
                        <jointGradient idref="jointGradientForDiagonal"/>
                    </compoundGradient>
                    <mask>
                        <parameter idref="mask.hmc"/>
                    </mask>
                    <multivariateCompoundTransform>
                        <LKJTransform dimension="13"/>
                        <transform type="log" dim="13"/>
                    </multivariateCompoundTransform>
                </hamiltonianMonteCarloOperator>
            </splitHamiltonianMonteCarloOperator>
        </NoUTurnOperator>
        <!--    <randomWalkOperator windowSize="1.0" weight="1">-->
        <!--      <parameter idref="variance.correlation"/>-->
        <!--      <LKJTransform dimension="13"/>-->
        <!--    </randomWalkOperator>-->
    </operators>
    <mcmc id="mcmc" fullEvaluation="-1" chainLength="10000" autoOptimize="true">
        <joint id="joint">
            <prior id="prior">
                <!--prior on the fixed tree-->
                <distributionLikelihood idref="prior.diagonal"/>
                <LKJCorrelationPrior idref="prior.cholesky"/>
            </prior>
            <likelihood id="likelihood">
                <traitDataLikelihood idref="scalarLikelihood"/>
                <latentLiabilityLikelihood idref="liabilityLikelihood"/>
            </likelihood>
        </joint>
        <operators idref="operators"/>
        <log id="screenLog" logEvery="1000">
            <column label="joint" dp="4" width="12">
                <joint idref="joint"/>
            </column>
            <column label="prior" dp="4" width="12">
                <prior idref="prior"/>
            </column>
            <column label="likelihood" dp="4" width="12">
                <likelihood idref="likelihood"/>
            </column>
        </log>
        <log id="fileLog1" logEvery="1" fileName="aquilegia_corr.log">
            <joint idref="joint"/>
            <prior idref="prior"/>
            <likelihood idref="likelihood"/>
            <parameter idref="variance.correlation"/>
            <parameter idref="variance.diagonal"/>
            <compoundSymmetricMatrix idref="varianceMatrix"/>
            <matrixParameter idref="precisionMatrix"/>
        </log>
        <log id="fileLog2" logEvery="1" fileName="aquilegia_latent.log">
            <joint idref="joint"/>
            <prior idref="prior"/>
            <likelihood idref="likelihood"/>
            <parameter idref="leafTraits"/>
        </log>
        <log logEvery="1" fileName="aquilegia_numEvent.log">
            <NoUTurnOperator idref="NUTS"/>
        </log>
    </mcmc>
    <report fileName="aquilegia_time.txt">
        <property name="timer">
            <mcmc idref="mcmc"/>
        </property>
    </report>
</beast>
